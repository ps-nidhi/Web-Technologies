<!DOCTYPE html>
<html>
<head>
    <title>Library Book Tracker</title>

    <style>
        body {
            font-family: Arial;
            background: #f4f4f4;
            padding: 30px;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        input, select {
            padding: 6px;
            margin: 4px;
        }

        button {
            padding: 6px 10px;
            margin: 4px;
            cursor: pointer;
        }

        table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        .success { color: green; }
        .error { color: red; }
    </style>
</head>

<body>

<div class="container">
    <h2>Library Book Tracker</h2>

    <div id="message"></div>

    <input type="text" id="bookId" placeholder="Book ID">
    <input type="text" id="title" placeholder="Title">
    <input type="text" id="author" placeholder="Author">
    <select id="status">
        <option value="Available">Available</option>
        <option value="Checked Out">Checked Out</option>
    </select>
    <button onclick="addBook()">Add Book</button>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="bookTable"></tbody>
    </table>
</div>

<script>
    let xmlDoc = null;

    function loadBooks() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "books.xml", true);
        xhr.onload = function () {
            if (xhr.status === 200) {
                if (!xhr.responseXML) {
                    showMessage("Malformed XML", "error");
                    return;
                }
                xmlDoc = xhr.responseXML;

                displayBooks();
            } else {
                showMessage("Failed to load XML (Status: " + xhr.status + ")", "error");
            }
        };
        xhr.onerror = function () {
            showMessage("Network error while loading XML", "error");
        };
        xhr.send();
    }

    function displayBooks() {
        const table = document.getElementById("bookTable");
        table.innerHTML = "";

        const books = xmlDoc.getElementsByTagName("book");
        for (let i = 0; i < books.length; i++) {
            const id = books[i].getElementsByTagName("id")[0].textContent;
            const title = books[i].getElementsByTagName("title")[0].textContent;
            const author = books[i].getElementsByTagName("author")[0].textContent;
            const status = books[i].getElementsByTagName("status")[0].textContent;

            const row = `
                <tr>
                    <td>${id}</td>
                    <td>${title}</td>
                    <td>${author}</td>
                    <td>${status}</td>
                    <td>
                        <button onclick="updateStatus('${id}')">Toggle Status</button>
                        <button onclick="deleteBook('${id}')">Delete</button>
                    </td>
                </tr>
            `;
            table.innerHTML += row;
        }
    }

 
    function addBook() {
        const id = document.getElementById("bookId").value.trim();
        const title = document.getElementById("title").value.trim();
        const author = document.getElementById("author").value.trim();
        const status = document.getElementById("status").value;

        if (!id || !title || !author) {
            showMessage("All fields are required", "error");
            return;
        }

        
        const books = xmlDoc.getElementsByTagName("book");
        for (let i = 0; i < books.length; i++) {
            const existingId = books[i].getElementsByTagName("id")[0].textContent;
            if (existingId === id) {
                showMessage("Book ID already exists", "error");
                return;
            }
        }

        const bookNode = xmlDoc.createElement("book");
        bookNode.appendChild(createNode("id", id));
        bookNode.appendChild(createNode("title", title));
        bookNode.appendChild(createNode("author", author));
        bookNode.appendChild(createNode("status", status));

        xmlDoc.getElementsByTagName("library")[0].appendChild(bookNode);

        displayBooks();
        showMessage("Book added successfully", "success");
    }

  
    function updateStatus(id) {
        const books = xmlDoc.getElementsByTagName("book");
        for (let i = 0; i < books.length; i++) {
            const bookId = books[i].getElementsByTagName("id")[0].textContent;
            if (bookId === id) {
                const statusNode = books[i].getElementsByTagName("status")[0];
                statusNode.textContent = statusNode.textContent === "Available" ? "Checked Out" : "Available";
                displayBooks();
                showMessage("Book status updated", "success");
                return;
            }
        }
        showMessage("Book not found", "error");
    }


    function deleteBook(id) {
        const books = xmlDoc.getElementsByTagName("book");
        for (let i = 0; i < books.length; i++) {
            const bookId = books[i].getElementsByTagName("id")[0].textContent;
            if (bookId === id) {
                books[i].parentNode.removeChild(books[i]);
                displayBooks();
                showMessage("Book deleted", "success");
                return;
            }
        }
        showMessage("Book not found", "error");
    }

    function createNode(tag, value) {
        const node = xmlDoc.createElement(tag);
        node.appendChild(xmlDoc.createTextNode(value));
        return node;
    }

    function showMessage(msg, type) {
        const messageDiv = document.getElementById("message");
        messageDiv.textContent = msg;
        messageDiv.className = type;
        setTimeout(() => messageDiv.textContent = "", 3000);
    }

    loadBooks(); 
</script>

</body>
</html>
