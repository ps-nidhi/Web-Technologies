<!DOCTYPE html>
<html>
<head>
    <title>Free Weather Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 350px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        input {
            width: 80%;
            padding: 8px;
            margin-bottom: 10px;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
        }

        .spinner {
            display: none;
            margin-top: 10px;
            color: blue;
        }

        .error {
            color: red;
        }

        .weather-info {
            margin-top: 15px;
        }
    </style>
</head>

<body>

<div class="container">
    <h2>Weather Dashboard </h2>

    <input type="text" id="cityInput" placeholder="Enter city name">
    <br>
    <button onclick="getWeather()">Get Weather</button>

    <div class="spinner" id="spinner">Loading...</div>
    <div id="message"></div>
    <div class="weather-info" id="weatherInfo"></div>
</div>

<script>
    let cachedCity = null;
    let cachedData = null;

    function getWeather() {
        const city = document.getElementById("cityInput").value.trim();
        const spinner = document.getElementById("spinner");
        const messageDiv = document.getElementById("message");
        const weatherDiv = document.getElementById("weatherInfo");

        messageDiv.innerHTML = "";
        weatherDiv.innerHTML = "";

        if (!city) {
            messageDiv.innerHTML = "<p class='error'>Please enter a city name</p>";
            return;
        }

        if (city.toLowerCase() === cachedCity) {
            displayWeather(cachedData);
            return;
        }

        spinner.style.display = "block";

        fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`)
            .then(response => response.json())
            .then(geoData => {

                if (!geoData.results || geoData.results.length === 0) {
                    throw new Error("City not found");
                }

                const lat = geoData.results[0].latitude;
                const lon = geoData.results[0].longitude;

                return fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m`
                );
            })
            .then(response => response.json())
            .then(data => {

                spinner.style.display = "none";

                if (!data.current_weather) {
                    throw new Error("Weather data unavailable");
                }

                // Cache result
                cachedCity = city.toLowerCase();
                cachedData = data;

                displayWeather(data);
            })
            .catch(error => {
                spinner.style.display = "none";
                messageDiv.innerHTML = `<p class="error">${error.message}</p>`;
            });
    }

    function displayWeather(data) {
        const weatherDiv = document.getElementById("weatherInfo");

        const temperature = data.current_weather.temperature;
        const windspeed = data.current_weather.windspeed;
        const weatherCode = data.current_weather.weathercode;

        weatherDiv.innerHTML = `
            <p><strong>Temperature:</strong> ${temperature}Â°C</p>
            <p><strong>Wind Speed:</strong> ${windspeed} km/h</p>
            <p><strong>Weather Code:</strong> ${weatherCode}</p>
        `;
    }
</script>

</body>
</html>
